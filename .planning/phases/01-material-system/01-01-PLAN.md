---
phase: 01-material-system
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/types/index.ts
  - src/data/defaultMaterials.ts
  - src/store/cabinetStore.ts
autonomous: true
---

<objective>
Enhance the Material type system to properly model edge banding compatibility and properties.

Purpose: Enable accurate edge banding calculations in later phases by establishing which edge banding materials are compatible with which board materials, and storing edge banding width separately from thickness.

Output: Updated Material interface with edge banding properties, updated default materials with compatibility data, and a helper function to query compatible edge banding.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Current implementation
@src/types/index.ts
@src/data/defaultMaterials.ts
@src/store/cabinetStore.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Enhance Material interface with edge banding properties</name>
  <files>src/types/index.ts</files>
  <action>
Add edge banding specific properties to the Material interface:

1. Add `edgeBandingWidth?: number` - The visible width of edge banding (22mm, 45mm) as separate from thickness (0.8mm, 2.0mm). Only applies when type is 'edge-banding'.

2. Add `compatibleEdgeBandingIds?: string[]` - Array of edge banding material IDs that are compatible with this board material. Only applies to board-type materials.

3. Add `matchesMaterialColor?: string` - For edge banding, the color/finish this banding is designed to match (e.g., 'white', 'oak', 'walnut'). This enables automatic compatibility suggestions.

Place these new optional properties in the existing Material interface after the existing properties section, before the costing section. Keep all existing properties unchanged.
  </action>
  <verify>TypeScript compilation passes: `cd /home/faky/Dev/work/Ligna && npm run build` shows no type errors</verify>
  <done>Material interface has edgeBandingWidth, compatibleEdgeBandingIds, and matchesMaterialColor properties</done>
</task>

<task type="auto">
  <name>Task 2: Update default materials with edge banding compatibility data</name>
  <files>src/data/defaultMaterials.ts</files>
  <action>
Update the existing defaultMaterials array with the new properties:

1. For edge banding materials (type: 'edge-banding'):
   - Add `edgeBandingWidth` property (22 for 22mm banding, 45 for 45mm banding)
   - Add `matchesMaterialColor` property ('white', 'oak', 'walnut', 'grey')

   Example for edge-white-22:
   ```typescript
   edgeBandingWidth: 22,
   matchesMaterialColor: 'white',
   ```

2. For board materials that can have edge banding applied:
   - Add `compatibleEdgeBandingIds` array referencing matching edge banding

   Example for melamine-white-18:
   ```typescript
   compatibleEdgeBandingIds: ['edge-white-22', 'edge-abs-white-45'],
   ```

Match edge banding to boards by color:
- White boards → edge-white-22, edge-abs-white-45
- Oak boards → edge-oak-22
- Walnut boards → edge-walnut-22
- Grey boards → edge-grey-22
- MDF/Plywood (raw) → all edge banding (can be painted/finished to match)

Do NOT add compatibility to back-panel or countertop materials (edge banding not typically applied).
  </action>
  <verify>TypeScript compilation passes: `cd /home/faky/Dev/work/Ligna && npm run build` shows no errors</verify>
  <done>All edge banding materials have width and color match properties; all compatible board materials have compatibleEdgeBandingIds arrays</done>
</task>

<task type="auto">
  <name>Task 3: Add helper function to get compatible edge banding</name>
  <files>src/store/cabinetStore.ts</files>
  <action>
Add a new selector function to the store that retrieves compatible edge banding for a given material:

1. Add function `getCompatibleEdgeBanding` to the store interface:
   ```typescript
   getCompatibleEdgeBanding: (materialId: string) => Material[];
   ```

2. Implement it in the store creation:
   ```typescript
   getCompatibleEdgeBanding: (materialId: string) => {
     const material = get().materials.find((m) => m.id === materialId);
     if (!material?.compatibleEdgeBandingIds) return [];
     return get().materials.filter((m) =>
       material.compatibleEdgeBandingIds!.includes(m.id)
     );
   },
   ```

3. Add a convenience hook export at the bottom of the file:
   ```typescript
   export const useCompatibleEdgeBanding = (materialId: string | undefined) => {
     const getCompatibleEdgeBanding = useCabinetStore((state) => state.getCompatibleEdgeBanding);
     return materialId ? getCompatibleEdgeBanding(materialId) : [];
   };
   ```

Place the store function near other getMaterialById, and the hook export near useMaterialById.
  </action>
  <verify>TypeScript compilation passes: `cd /home/faky/Dev/work/Ligna && npm run build` shows no errors</verify>
  <done>getCompatibleEdgeBanding function and useCompatibleEdgeBanding hook are exported and usable</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run build` succeeds without errors
- [ ] Material interface has new properties (edgeBandingWidth, compatibleEdgeBandingIds, matchesMaterialColor)
- [ ] Default materials updated with compatibility data
- [ ] getCompatibleEdgeBanding function works in store
- [ ] useCompatibleEdgeBanding hook exported
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- No TypeScript errors introduced
- Material system ready for Phase 2 (Part-Material Association)
</success_criteria>

<output>
After completion, create `.planning/phases/01-material-system/01-01-SUMMARY.md`
</output>
